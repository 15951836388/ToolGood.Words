// ToolGood.Words.WordsSearch.js
// 2020, Lin Zhijun, https://github.com/toolgood/ToolGood.Words
// Licensed under the Apache License 2.0
function WordsSearch(){function v(){this.Layer=this.Index=0;this.End=!1;this.Char="";this.Results=[];this.m_values={};this.Parent=this.Failure=null;this.Add=function(b){if(null!=this.m_values[b])return this.m_values[b];var d=new v;d.Parent=this;d.Char=b;return this.m_values[b]=d};this.SetResults=function(b){0==this.End&&(this.End=!0);this.Results.push(b)}}function w(){this.End=!1;this.Results=[];this.m_values={};this.minflag=65535;this.maxflag=0;this.Add=function(b,d){this.minflag>b&&(this.minflag=b);this.maxflag<b&&(this.maxflag=b);this.m_values[b]=d};this.SetResults=function(b){0==this.End&&(this.End=!0);-1==this.Results.indexOf(b)&&this.Results.push(b)};this.HasKey=function(b){return void 0!=this.m_values[b]};this.TryGetValue=function(b){return this.minflag<=b&&this.maxflag>=b?this.m_values[b]:null}}var k=[],l=[],t=[];this.SetKeywords=function(b){l=b;for(var d=0;d<b.length;d++)t.push(d);b=new v;d=[];d.push(b);for(var e={},c=0;c<l.length;c++){for(var f=l[c],a=b,r=0;r<f.length;r++)a=a.Add(f.charCodeAt(r)),0==a.Layer&&(a.Layer=r+1,e[a.Layer]||(e[a.Layer]=[]),e[a.Layer].push(a));a.SetResults(c)}for(var g in e)for(a=e[g],c=0;c<a.length;c++)d.push(a[c]);c=[];for(g in b.m_values)if(0!=b.m_values.hasOwnProperty(g)){a=b.m_values[g];a.Failure=b;for(var q in a.m_values)0!=a.m_values.hasOwnProperty(q)&&c.push(a.m_values[q])}for(;0!=c.length;){q=[];for(g in c)if(0!=c.hasOwnProperty(g)){a=c[g];e=a.Parent.Failure;for(f=a.Char;null!=e&&!e.m_values[f];)e=e.Failure;if(null==e)a.Failure=b;else{a.Failure=e.m_values[f];for(var h in a.Failure.Results)0!=a.Failure.Results.hasOwnProperty(h)&&a.SetResults(a.Failure.Results[h])}for(var m in a.m_values)0!=a.m_values.hasOwnProperty(m)&&q.push(a.m_values[m])}c=q}b.Failure=b;for(c=0;c<d.length;c++)d[c].Index=c;g=[];for(c=0;c<d.length;c++)g.push(new w);for(c=0;c<g.length;c++){h=d[c];m=g[c];for(var n in h.m_values)0!=h.m_values.hasOwnProperty(n)&&(a=h.m_values[n].Index,m.Add(n,g[a]));for(a=0;a<h.Results.length;a++)m.SetResults(h.Results[a]);if(h.Failure!=b){for(var p in h.Failure.m_values)0!=h.Failure.m_values.hasOwnProperty(p)&&0==m.HasKey(p)&&(a=h.Failure.m_values[p].Index,m.Add(p,g[a]));for(a=0;a<h.Failure.Results.length;a++)m.SetResults(h.Failure.Results[a])}}n=[];for(p=0;65535>p;p++)n.push(null);for(var u in g[0].m_values)0!=g[0].m_values.hasOwnProperty(u)&&(n[u]=g[0].m_values[u]);k=n};this.FindFirst=function(b){for(var d=null,e=0;e<b.length;e++){var c=b.charCodeAt(e);null==d?d=k[c]:(d=d.TryGetValue(c))||(d=k[c]);if(null!=d&&d.End)return b=d.Results[0],{Keyword:l[b],Success:!0,End:e,Start:e+1-l[b].length,Index:t[b]}}return null};this.FindAll=function(b){for(var d=null,e=[],c=0;c<b.length;c++){var f=b.charCodeAt(c);null==d?d=k[f]:(d=d.TryGetValue(f))||(d=k[f]);if(null!=d&&d.End)for(f=0;f<d.Results.length;f++){var a=d.Results[f];e.push({Keyword:l[a],Success:!0,End:c,Start:c+1-l[a].length,Index:t[a]})}}return e};this.ContainsAny=function(b){for(var d=null,e=0;e<b.length;e++){var c=b.charCodeAt(e);null==d?d=k[c]:(d=d.TryGetValue(c))||(d=k[c]);if(null!=d&&d.End)return!0}return!1};this.Replace=function(b,d){d=void 0===d?"*":d;for(var e=b.split(""),c=null,f=0;f<b.length;f++){var a=b.charCodeAt(f);null==c?c=k[a]:(c=c.TryGetValue(a))||(c=k[a]);if(null!=c&&c.End)for(a=f+1-l[c.Results[0]].length;a<=f;a++)e[a]=d}return e.join("")}};